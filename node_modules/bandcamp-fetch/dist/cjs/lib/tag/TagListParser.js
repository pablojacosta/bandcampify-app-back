"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cheerio_1 = require("cheerio");
const Parse_1 = require("../utils/Parse");
class TagListParser {
    static parseTags(html) {
        const $ = (0, cheerio_1.load)(html);
        const _findTag = (tagUrl, tagName, tags) => {
            return tags.find((t) => t.url === tagUrl && t.name === tagName);
        };
        const _parseCloud = (id) => {
            const cloud = $(`#${id}`);
            const tagsInCloud = [];
            cloud.find('a.tag').each((index, link) => {
                const linkEl = $(link);
                const name = linkEl.text().trim();
                const href = linkEl.attr('href');
                if (href) {
                    const url = (0, Parse_1.normalizeUrl)(href);
                    if (name && href !== '/tag/' && !_findTag(url, name, tagsInCloud)) { // Skip blank or repeating tags
                        tagsInCloud.push({
                            name,
                            url
                        });
                    }
                }
            });
            return tagsInCloud;
        };
        return {
            tags: _parseCloud('tags_cloud'),
            locations: _parseCloud('locations_cloud')
        };
    }
}
exports.default = TagListParser;
//# sourceMappingURL=TagListParser.js.map