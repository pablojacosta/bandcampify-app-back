{"version":3,"file":"ArticleAPI.js","sourceRoot":"","sources":["../../../../src/lib/article/ArticleAPI.ts"],"names":[],"mappings":";;;;;;AAAA,iEAAyC;AAGzC,kDAA0C;AAC1C,0CAA2C;AAC3C,+DAAuC;AACvC,0CAA8C;AAC9C,oFAA4D;AAC5D,4EAAoD;AACpD,oEAA4C;AAe5C,MAAqB,UAAU;IAE7B,MAAM,CAAC,KAAK,CAAC,aAAa;QACxB,MAAM,IAAI,GAAG,MAAM,IAAA,iBAAS,EAAC,gBAAI,CAAC,KAAK,CAAC,CAAC;QACzC,OAAO,+BAAqB,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;IACrD,CAAC;IAED,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,MAAkC;QACxD,MAAM,cAAc,GAAG,MAAM,kBAAQ,CAAC,YAAY,EAAE,CAAC;QACrD,MAAM,IAAI,GAAG;YACX,YAAY,EAAE,cAAc,CAAC,OAAO;YACpC,gBAAgB,EAAE,MAAM,kBAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,gBAAgB,EAAE,CAAC,CAAC;YACtE,iBAAiB,EAAE,MAAM,kBAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,iBAAiB,EAAE,EAAE,CAAC;YACzE,cAAc,EAAE,CAAC,CAAC,MAAM,CAAC,cAAc;SACxC,CAAC;QACF,MAAM,IAAI,GAAG,MAAM,IAAA,iBAAS,EAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QAChD,OAAO,uBAAa,CAAC,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IAChD,CAAC;IAED,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAA6B;QAC7C,IAAI,GAAG,GAAG,MAAM,EAAE,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,IAAA,oBAAY,EAAC,QAAQ,EAAE,gBAAI,CAAC,KAAK,CAAC,CAAC;QACxF,IAAI,MAAM,EAAE,IAAI,EAAE;YAChB,GAAG,IAAI,SAAS,MAAM,CAAC,IAAI,EAAE,CAAC;SAC/B;QACD,MAAM,IAAI,GAAG;YACX,WAAW,EAAE,MAAM,kBAAQ,CAAC,SAAS,CAAC,MAAM,EAAE,WAAW,CAAC;SAC3D,CAAC;QACF,MAAM,IAAI,GAAG,MAAM,IAAA,iBAAS,EAAC,GAAG,CAAC,CAAC;QAClC,OAAO,2BAAiB,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IACjD,CAAC;CACF;AA9BD,6BA8BC;AAED,MAAa,iBAAkB,SAAQ,UAAU;IAE/C,MAAM,CAAC,KAAK,CAAC,aAAa;QACxB,OAAO,iBAAO,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC,CAAC;IACvD,CAAC;IAED,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,MAAkC;QACxD,OAAO,iBAAO,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC;IAC1D,CAAC;CACF;AATD,8CASC","sourcesContent":["import ImageAPI from '../image/ImageAPI';\nimport Article, { ArticleCategorySection, ArticleList } from '../types/Article';\nimport { ImageFormat } from '../types/Image';\nimport { URLS } from '../utils/Constants';\nimport { fetchPage } from '../utils/Fetch';\nimport Limiter from '../utils/Limiter';\nimport { normalizeUrl } from '../utils/Parse';\nimport ArticleCategoryParser from './ArticleCategoryParser';\nimport ArticleListParser from './ArticleListParser';\nimport ArticleParser from './ArticleParser';\n\nexport interface ArticleAPIGetArticleParams {\n  articleUrl: string;\n  albumImageFormat?: string | number | ImageFormat;\n  artistImageFormat?: string | number | ImageFormat;\n  includeRawData?: boolean;\n}\n\nexport interface ArticleAPIListParams {\n  categoryUrl?: string;\n  imageFormat?: string | number | ImageFormat;\n  page?: number;\n}\n\nexport default class ArticleAPI {\n\n  static async getCategories(): Promise<ArticleCategorySection[]> {\n    const html = await fetchPage(URLS.DAILY);\n    return ArticleCategoryParser.parseCategories(html);\n  }\n\n  static async getArticle(params: ArticleAPIGetArticleParams): Promise<Article> {\n    const imageConstants = await ImageAPI.getConstants();\n    const opts = {\n      imageBaseUrl: imageConstants.baseUrl,\n      albumImageFormat: await ImageAPI.getFormat(params.albumImageFormat, 9),\n      artistImageFormat: await ImageAPI.getFormat(params.artistImageFormat, 21),\n      includeRawData: !!params.includeRawData\n    };\n    const html = await fetchPage(params.articleUrl);\n    return ArticleParser.parseArticle(html, opts);\n  }\n\n  static async list(params?: ArticleAPIListParams): Promise<ArticleList> {\n    let url = params?.categoryUrl ? params.categoryUrl : normalizeUrl('latest', URLS.DAILY);\n    if (params?.page) {\n      url += `?page=${params.page}`;\n    }\n    const opts = {\n      imageFormat: await ImageAPI.getFormat(params?.imageFormat)\n    };\n    const html = await fetchPage(url);\n    return ArticleListParser.parseList(html, opts);\n  }\n}\n\nexport class LimiterArticleAPI extends ArticleAPI {\n\n  static async getCategories(): Promise<ArticleCategorySection[]> {\n    return Limiter.schedule(() => super.getCategories());\n  }\n\n  static async getArticle(params: ArticleAPIGetArticleParams): Promise<Article> {\n    return Limiter.schedule(() => super.getArticle(params));\n  }\n}\n"]}