{"version":3,"file":"ArticleCategoryParser.js","sourceRoot":"","sources":["../../../../src/lib/article/ArticleCategoryParser.ts"],"names":[],"mappings":"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","sourcesContent":["import { load as cheerioLoad } from 'cheerio';\nimport { ArticleCategorySection } from '../types/Article';\nimport { URLS } from '../utils/Constants';\nimport { isAbsoluteUrl, normalizeUrl } from '../utils/Parse';\n\nexport default class ArticleCategoryParser {\n\n  static parseCategories(html: string): ArticleCategorySection[] {\n    const $ = cheerioLoad(html);\n    const dailyUrl = URLS.DAILY;\n\n    const _parseSection = (section: any) => {\n      const h = section.prev('h2');\n      const title = h.length ? h.text() : '';\n      const s: ArticleCategorySection = {\n        name: section.attr('class'),\n        title,\n        sections: [],\n        categories: []\n      };\n      section.children().each((i: number, c: any) => {\n        const tag = c.tagName;\n        c = $(c);\n        if (tag === 'section') {\n          const parsed = _parseSection($(c));\n          if (parsed !== null && s.sections) {\n            s.sections.push(parsed);\n          }\n        }\n        else if (tag === 'div') {\n          c.find('a').each((i: number, a: any) => {\n            a = $(a);\n            let url = a.attr('href');\n            if (!isAbsoluteUrl(url)) {\n              url = normalizeUrl(url, dailyUrl);\n            }\n            if (s.categories) {\n              s.categories.push({\n                url,\n                name: a.text()\n              });\n            }\n          });\n\n        }\n      });\n      if (s.sections?.length === 0) {\n        delete s.sections;\n      }\n      if (s.categories?.length === 0) {\n        delete s.categories;\n      }\n      if (!s.sections && !s.categories) {\n        return null;\n      }\n\n      return s;\n    };\n\n    const sections = $('#daily-view-all').children('section');\n    const results: ArticleCategorySection[] = [];\n    sections.each((i, section) => {\n      const parsed = _parseSection($(section));\n      if (parsed !== null) {\n        results.push(parsed);\n      }\n    });\n\n    return results;\n  }\n}\n"]}